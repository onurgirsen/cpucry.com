<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chaos Snowflakes â€” DOM Split Demo</title>
  <style>
    :root{
      --bg:#0b1020;--panel:#121933;--text:#e7ecff;--muted:#93a0c8;--accent:#6aa3ff;--danger:#ff5b6a
    }
    *{box-sizing:border-box}
    body{margin:0;min-height:100svh;background:radial-gradient(1200px 600px at 70% -10%,#1b2550 0%,var(--bg) 50%);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    header{padding:16px 20px;display:flex;align-items:center;gap:14px;flex-wrap:wrap}
    header h1{font-size:18px;margin:0;letter-spacing:.2px;opacity:.95}
    .badge{padding:4px 8px;border-radius:999px;background:#1a244b;color:var(--muted);font-size:12px}

    .wrap{display:grid;grid-template-columns:320px 1fr;gap:16px;padding:0 20px 20px}
    @media (max-width:900px){.wrap{grid-template-columns:1fr}}

    .panel{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,0));border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:16px;box-shadow:0 6px 24px rgba(0,0,0,.25)}
    .controls{display:grid;gap:12px}
    .row{display:grid;gap:8px;align-items:center}
    .row>label{font-size:12px;color:var(--muted)}
    input[type="range"],input[type="number"],select{width:100%}
    .buttons{display:flex;gap:8px;flex-wrap:wrap}
    button{appearance:none;border:none;border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer;background:#1e2a57;color:var(--text);box-shadow:inset 0 0 0 1px rgba(255,255,255,.06);transition:transform .05s ease,filter .15s ease}
    button:hover{filter:brightness(1.08)}
    button:active{transform:translateY(1px)}
    .primary{background:linear-gradient(180deg,#2d5fff,#2347b6)}
    .danger{background:linear-gradient(180deg,var(--danger),#cc2b40)}

    .stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px}
    .stat{background:#0e1533;border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:10px;display:grid;gap:4px}
    .stat small{color:var(--muted);font-size:11px}
    .stat strong{font-variant-numeric:tabular-nums}

    .stage{position:relative;height:60svh;border-radius:16px;border:1px solid rgba(255,255,255,.06);overflow:hidden;background:linear-gradient(#0c122a,#060914)}
    .flake{position:absolute;border-radius:50%;pointer-events:none;will-change:transform;box-shadow:0 0 8px rgba(255,255,255,.25)}
    .watermark{position:absolute;right:8px;bottom:8px;font-size:10px;color:#7f8bb3;opacity:.7}

    footer{padding:12px 20px;color:var(--muted);font-size:12px;opacity:.9}
    kbd{background:#1b254e;border:1px solid rgba(255,255,255,.13);padding:2px 6px;border-radius:6px;font-size:11px}
  </style>
</head>
<body>
  <header>
    <h1>Chaos Snowflakes</h1>
    <span class="badge">exponentially multiplying DOM nodes</span>
  </header>

  <section class="wrap">
    <aside class="panel">
      <div class="controls">
        <div class="row">
          <label for="spawn">Spawn per second <span id="spawnVal"></span></label>
          <input id="spawn" type="range" min="0" max="500" step="1" value="50" />
        </div>
        <div class="row">
          <label for="grav">Gravity (px/s) <span id="gravVal"></span></label>
          <input id="grav" type="range" min="10" max="800" step="10" value="150" />
        </div>
        <div class="row">
          <label for="wind">Wind (px/s) <span id="windVal"></span></label>
          <input id="wind" type="range" min="-300" max="300" step="10" value="0" />
        </div>
        <div class="row">
          <label for="offset">Split offset (px) <span id="offsetVal"></span></label>
          <input id="offset" type="range" min="0" max="80" step="2" value="24" />
        </div>
        <div class="row">
          <label for="max">Max flakes cap <span id="maxVal"></span></label>
          <input id="max" type="range" min="100" max="100000" step="100" value="5000" />
        </div>
        <div class="buttons">
          <button id="start" class="primary">Start</button>
          <button id="pause">Pause</button>
          <button id="reset">Reset</button>
          <button id="panic" class="danger" title="Immediately stop and clear">PANIC</button>
          <button id="crash" class="danger">ðŸ’¥ Crash Mode</button>
        </div>
        <div class="stats">
          <div class="stat"><small>Flake count</small><strong id="count">0</strong></div>
          <div class="stat"><small>FPS (approx)</small><strong id="fps">0</strong></div>
          <div class="stat"><small>Splits total</small><strong id="splits">0</strong></div>
        </div>
        <p style="margin-top:8px;color:var(--muted);font-size:12px;line-height:1.4">
          Each flake that touches the floor <strong>splits into two</strong> and continues falling from the top. This grows the number of DOM nodes rapidly â€” enjoy the slow-mo. Use <kbd>Esc</kbd> or <strong>PANIC</strong> if things get out of hand.
        </p>
      </div>
    </aside>

    <main class="panel">
      <div class="stage" id="stage">
        <div class="watermark">v1 Â· chaos-snowflakes (DOM)</div>
      </div>
    </main>
  </section>

  <footer>
    DOM-based simulation: lots of absolutely-positioned elements updated each frame. Splitting causes exponential growth and eventual browser slowdown.
  </footer>

<script>
(() => {
  const $ = (id) => document.getElementById(id);
  const stage = $('stage');
  const spawnEl = $('spawn');
  const gravEl = $('grav');
  const windEl = $('wind');
  const offsetEl = $('offset');
  const maxEl = $('max');
  const spawnVal = $('spawnVal');
  const gravVal = $('gravVal');
  const windVal = $('windVal');
  const offsetVal = $('offsetVal');
  const maxVal = $('maxVal');
  const startBtn = $('start');
  const pauseBtn = $('pause');
  const resetBtn = $('reset');
  const panicBtn = $('panic');
  const crashBtn = $('crash');
  const countEl = $('count');
  const fpsEl = $('fps');
  const splitsEl = $('splits');

  let flakes = []; // {x,y,vx,vy,size,el}
  let running = false;
  let lastTime = performance.now();
  let lastFpsTime = performance.now();
  let frames=0;
  let splitCount=0;
  let accSpawn=0; // accumulator for spawn/sec

  function updateLabels(){
    spawnVal.textContent = '('+spawnEl.value+'/s)';
    gravVal.textContent = '('+gravEl.value+')';
    windVal.textContent = '('+windEl.value+')';
    offsetVal.textContent = '('+offsetEl.value+'px)';
    maxVal.textContent = '('+maxEl.value+')';
  }
  updateLabels();

  function rand(min,max){return Math.random()*(max-min)+min;}

  function makeFlake(x){
    const size = Math.max(2, Math.min(8, Math.round(rand(2,6))));
    const el = document.createElement('div');
    el.className='flake';
    el.style.width = size+'px';
    el.style.height = size+'px';
    el.style.background = 'rgba(255,255,255,0.95)';
    el.style.transform = `translate(${x}px,-${size}px)`;
    stage.appendChild(el);
    const f = { x, y: -size, vx: rand(-20,20), vy: 0, size, el };
    flakes.push(f);
    countEl.textContent = flakes.length.toLocaleString('en-US');
  }

  function spawn(dt){
    const perSec = +spawnEl.value;
    accSpawn += perSec * dt; // expected count this frame
    let n = Math.floor(accSpawn);
    if (n>0) accSpawn -= n;
    const W = stage.clientWidth;
    while(n-->0 && flakes.length < +maxEl.value){
      makeFlake(rand(0, Math.max(0, W-8))|0);
    }
  }

  function splitFlake(i){
    const old = flakes[i];
    // remove old from DOM & array; replace with 2 children
    stage.removeChild(old.el);
    flakes.splice(i,1);
    const off = +offsetEl.value;
    const W = stage.clientWidth;
    const leftX = Math.max(0, Math.min(W-8, old.x - off*0.5 + rand(-6,6)));
    const rightX = Math.max(0, Math.min(W-8, old.x + off*0.5 + rand(-6,6)));
    makeFlake(leftX);
    makeFlake(rightX);
    splitCount++;
    splitsEl.textContent = splitCount.toLocaleString('en-US');
  }

  function step(time){
    if (!running) return;
    const now = time || performance.now();
    let dt = (now - lastTime)/1000; // seconds
    if (dt>0.1) dt = 0.1; // clamp to avoid jumps
    lastTime = now;

    // FPS approx
    frames++;
    const dft = now - lastFpsTime;
    if (dft >= 500){
      const fps = (frames / (dft/1000))|0;
      fpsEl.textContent = fps.toString();
      frames=0; lastFpsTime = now;
    }

    spawn(dt);

    const H = stage.clientHeight;
    const W = stage.clientWidth;
    const g = +gravEl.value;
    const wind = +windEl.value;

    // Update existing flakes
    for (let i=flakes.length-1; i>=0; i--){
      const f = flakes[i];
      f.vy += g * dt;
      f.vx += wind * dt * 0.1; // gentle wind acceleration
      f.x += f.vx * dt;
      f.y += f.vy * dt;

      // keep inside horizontally
      if (f.x < 0){ f.x = 0; f.vx *= -0.3; }
      if (f.x > W - f.size){ f.x = W - f.size; f.vx *= -0.3; }

      if (f.y >= H - f.size){
        // touch floor -> split into 2, restart from top
        splitFlake(i);
        continue;
      }

      f.el.style.transform = `translate(${f.x|0}px,${f.y|0}px)`;
    }

    requestAnimationFrame(step);
  }

  function start(){ if (running) return; running = true; lastTime = performance.now(); requestAnimationFrame(step); }
  function pause(){ running = false; }
  function reset(){
    pause();
    splitCount=0; splitsEl.textContent='0';
    flakes.forEach(f=>{ try{ stage.removeChild(f.el);}catch{} });
    flakes.length = 0; countEl.textContent='0';
    accSpawn=0; lastFpsTime=performance.now(); frames=0; fpsEl.textContent='0';
  }
  function panic(){ reset(); }
  function crash(){
    spawnEl.value='500'; gravEl.value='300'; windEl.value='80'; offsetEl.value='40'; maxEl.value='100000'; updateLabels();
    if (!running) start();
  }

  spawnEl.addEventListener('input', updateLabels);
  gravEl.addEventListener('input', updateLabels);
  windEl.addEventListener('input', updateLabels);
  offsetEl.addEventListener('input', updateLabels);
  maxEl.addEventListener('input', updateLabels);

  startBtn.addEventListener('click', start);
  pauseBtn.addEventListener('click', pause);
  resetBtn.addEventListener('click', reset);
  panicBtn.addEventListener('click', panic);
  crashBtn.addEventListener('click', crash);
  window.addEventListener('keydown', (e)=>{ if (e.key==='Escape') panic(); });

  // boot: place a few initial flakes so it's visible before start
  for (let i=0;i<25;i++) makeFlake(Math.random()*(stage.clientWidth-8));
})();
</script>
</body>
</html>
