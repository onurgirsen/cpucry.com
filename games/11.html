<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Growing Numbers â€” Fibonacci Crash Demo</title>
  <style>
    :root{
      --bg:#0b1020;--panel:#121933;--text:#e7ecff;--muted:#93a0c8;--accent:#6aa3ff;--danger:#ff5b6a
    }
    *{box-sizing:border-box}
    body{margin:0;min-height:100svh;background:radial-gradient(1200px 600px at 70% -10%,#1b2550 0%,var(--bg) 50%);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    header{padding:16px 20px;display:flex;align-items:center;gap:14px;flex-wrap:wrap}
    header h1{font-size:18px;margin:0;letter-spacing:.2px;opacity:.95}
    .badge{padding:4px 8px;border-radius:999px;background:#1a244b;color:var(--muted);font-size:12px}

    .wrap{display:grid;grid-template-columns:320px 1fr;gap:16px;padding:0 20px 20px}
    @media (max-width:900px){.wrap{grid-template-columns:1fr}}

    .panel{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,0));border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:16px;box-shadow:0 6px 24px rgba(0,0,0,.25)}
    .controls{display:grid;gap:12px}
    .row{display:grid;gap:8px;align-items:center}
    .row>label{font-size:12px;color:var(--muted)}
    input[type="range"],input[type="number"],select{width:100%}
    .buttons{display:flex;gap:8px;flex-wrap:wrap}
    button{appearance:none;border:none;border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer;background:#1e2a57;color:var(--text);box-shadow:inset 0 0 0 1px rgba(255,255,255,.06);transition:transform .05s ease,filter .15s ease}
    button:hover{filter:brightness(1.08)}
    button:active{transform:translateY(1px)}
    .primary{background:linear-gradient(180deg,#2d5fff,#2347b6)}
    .danger{background:linear-gradient(180deg,var(--danger),#cc2b40)}

    .stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px}
    .stat{background:#0e1533;border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:10px;display:grid;gap:4px}
    .stat small{color:var(--muted);font-size:11px}
    .stat strong{font-variant-numeric:tabular-nums}

    .viewer{background:#020615;border-radius:16px;border:1px solid rgba(255,255,255,.06);padding:12px;height:60svh;overflow:auto}
    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;white-space:pre-wrap;word-break:break-word}

    footer{padding:12px 20px;color:var(--muted);font-size:12px;opacity:.9}
    kbd{background:#1b254e;border:1px solid rgba(255,255,255,.13);padding:2px 6px;border-radius:6px;font-size:11px}
  </style>
</head>
<body>
  <header>
    <h1>Growing Numbers â€” Fibonacci</h1>
    <span class="badge">string-heavy, browser-melting fun</span>
  </header>

  <section class="wrap">
    <aside class="panel">
      <div class="controls">
        <div class="row">
          <label for="iters">Iterations per update <span id="itersVal"></span></label>
          <input id="iters" type="range" min="0" max="100000" step="1" value="1" />
        </div>
        <div class="row">
          <label for="interval">Update interval (ms) <span id="intervalVal"></span></label>
          <input id="interval" type="range" min="100" max="2000" step="50" value="1000" />
        </div>
        <div class="row">
          <label><input id="renderFull" type="checkbox" /> Render full number (heavy)</label>
        </div>
        <div class="buttons">
          <button id="start" class="primary">Start</button>
          <button id="pause">Pause</button>
          <button id="reset">Reset</button>
          <button id="panic" class="danger" title="Immediately stop and clear">PANIC</button>
          <button id="crash" class="danger">ðŸ’¥ Crash Mode</button>
        </div>
        <div class="stats">
          <div class="stat"><small>Index (n)</small><strong id="idx">0</strong></div>
          <div class="stat"><small>Digits</small><strong id="digits">1</strong></div>
          <div class="stat"><small>Approx Î”digits/s</small><strong id="ddps">0</strong></div>
        </div>
        <p style="margin-top:8px;color:var(--muted);font-size:12px;line-height:1.4">
          <strong>Tip:</strong> Enable <em>Render full number</em> to really punish the DOM. <br/>
          <em>Safety:</em> Use <kbd>Esc</kbd> or <strong>PANIC</strong> if things get out of hand.
        </p>
      </div>
    </aside>

    <main class="panel">
      <div class="viewer mono" id="viewer">1</div>
      <div class="mono" style="margin-top:8px;color:var(--muted)">
        Preview: <span id="preview"></span>
      </div>
    </main>
  </section>

  <footer>
    Starts at 1; each update advances Fibonacci by N iterations (configurable). Numbers explode in size; conversions to string and DOM updates become a bottleneck.
  </footer>

<script>
(() => {
  const $ = (id) => document.getElementById(id);
  const viewer = $('viewer');
  const preview = $('preview');
  const idxEl = $('idx');
  const digitsEl = $('digits');
  const ddpsEl = $('ddps');
  const itersEl = $('iters');
  const itersVal = $('itersVal');
  const intervalEl = $('interval');
  const intervalVal = $('intervalVal');
  const renderFullEl = $('renderFull');
  const startBtn = $('start');
  const pauseBtn = $('pause');
  const resetBtn = $('reset');
  const panicBtn = $('panic');
  const crashBtn = $('crash');

  let a = 0n;
  let b = 1n;
  let n = 1;
  let running = false;
  let timer = null;
  let lastDigits = 1;
  let lastTime = performance.now();

  const fmt = (x) => x.toLocaleString('en-US');
  function updateLabels(){
    itersVal.textContent = '(' + itersEl.value + ')';
    intervalVal.textContent = '(' + intervalEl.value + ' ms)';
  }
  updateLabels();

  function stepK(k){
    for (let i=0;i<k;i++){
      const next = a + b;
      a = b;
      b = next;
      n++;
    }
  }

  function render(){
    const s = b.toString();
    const len = s.length;
    idxEl.textContent = fmt(n);
    digitsEl.textContent = fmt(len);

    const now = performance.now();
    const dt = (now - lastTime)/1000;
    const dd = Math.max(0, len - lastDigits);
    const rate = dt > 0 ? (dd/dt) : 0;
    ddpsEl.textContent = Math.round(rate).toString();
    lastTime = now; lastDigits = len;

    if (renderFullEl.checked){
      viewer.textContent = s;
    } else {
      const head = s.slice(0, 32);
      const tail = s.slice(-32);
      viewer.textContent = head + (len>64 ? ' â€¦ ' : '') + (len>64 ? tail : '');
    }
    preview.textContent = s.slice(0, 12) + (len>24 ? ' â€¦ ' : '') + s.slice(-12) + '  (len=' + fmt(len) + ')';
  }

  function tick(){
    const k = Math.max(0, parseInt(itersEl.value,10)|0);
    if (k > 0) {
      stepK(k);
      render();
    }
  }

  function start(){
    if (running) return;
    running = true;
    schedule();
  }

  function schedule(){
    const ms = Math.max(10, parseInt(intervalEl.value,10)|0);
    timer = setInterval(tick, ms);
  }

  function pause(){
    running = false;
    if (timer) clearInterval(timer);
    timer = null;
  }

  function reset(){
    pause();
    a = 0n; b = 1n; n = 1; lastDigits = 1; lastTime = performance.now();
    viewer.textContent = '1';
    preview.textContent = '1';
    idxEl.textContent = '1';
    digitsEl.textContent = '1';
    ddpsEl.textContent = '0';
  }

  function panic(){
    try{ pause(); }catch{}
    viewer.textContent = '';
    preview.textContent = '';
  }

  function crash(){
    itersEl.value = '1000';
    intervalEl.value = '50';
    renderFullEl.checked = true;
    updateLabels();
    if (!running) start();
  }

  itersEl.addEventListener('input', updateLabels);
  intervalEl.addEventListener('input', updateLabels);
  startBtn.addEventListener('click', start);
  pauseBtn.addEventListener('click', pause);
  resetBtn.addEventListener('click', reset);
  panicBtn.addEventListener('click', panic);
  crashBtn.addEventListener('click', crash);
  window.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') panic(); });

  reset();
})();
</script>
</body>
</html>
